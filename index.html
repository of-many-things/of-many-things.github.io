<!DOCTYPE html>
<meta charset="UTF-8">
<html>
    <head>
        <title>Нуменера</title>
    </head>
    <body>
        <button type = "button" onclick="make_oddity()">Диковина</button>
        <button type = "button" onclick="document.getElementById('text').innerHTML = make_ruin()">Кусок руин</button>
        <p id="text"></p>
    </body>
    <script>
        const quality_chance = "0.2";
        const feel_chance = "0.1";
        const size_chance = "0.3";
        const time_adverb_chance = "0.1";
        const shape_chance = "0.3";
        const color_chance = "0.2";
        const material_chance = "0.8";
        const with_chance = "0.1";
        const that_chance = "0.9";
        const if_chance = "0.4";

        const pronoun_cases = {
            "nom": {"m": "он", "f": "она", "n": "оно"},
            "gen": {"m": "его", "f": "её", "n": "его"},
            "pgen": {"m": "него", "f": "неё", "n": "него"},
            "ins": {"m": "им", "f": "ей", "n": "им"},
            "pins": {"m": "ним", "f": "ней", "n": "ним"},
            "acc": {"m": "его", "f": "её", "n": "его"},
            "pacc": {"m": "него", "f": "неё", "n": "него"},
            "dat": {"m": "ему", "f": "ей", "n": "ему"},
            "pdat": {"m": "нему", "f": "ней", "n": "нему"},
            "ploc": {"m": "нём", "f": "ней", "n": "нём"},
        }

        const short_adjectives = {
            "m": "", "f": "а", "n": "о"
        };

        const adjectives_endings = {
            "hard_y": {
                "m": {"nom": "ый", "gen": "ого", "dat": "ому", "acc": "ый", "ins": "ым", "loc": "ом"},
                "ma": {"nom": "ый", "gen": "ого", "dat": "ому", "acc": "ого", "ins": "ым", "loc": "ом"},
                "f": {"nom": "ая", "gen": "ой", "dat": "ой", "acc": "ую", "ins": "ой", "loc": "ой"},
                "n": {"nom": "ое", "gen": "ого", "dat": "ому", "acc": "ое", "ins": "ым", "loc": "ом"},
                "p": {"nom": "ые", "gen": "ых", "dat": "ым", "acc": "ые", "ins": "ыми", "loc": "ых"},
                "pa": {"nom": "ые", "gen": "ых", "dat": "ым", "acc": "ых", "ins": "ыми", "loc": "ых"},
            },
            "hard_o": {
                "m": {"nom": "ой", "gen": "ого", "dat": "ому", "acc": "ый", "ins": "ым", "loc": "ом"},
                "ma": {"nom": "ой", "gen": "ого", "dat": "ому", "acc": "ого", "ins": "ым", "loc": "ом"},
                "f": {"nom": "ая", "gen": "ой", "dat": "ой", "acc": "ую", "ins": "ой", "loc": "ой"},
                "n": {"nom": "ое", "gen": "ого", "dat": "ому", "acc": "ое", "ins": "ым", "loc": "ом"},
                "p": {"nom": "ые", "gen": "ых", "dat": "ым", "acc": "ые", "ins": "ыми", "loc": "ых"},
                "pa": {"nom": "ые", "gen": "ых", "dat": "ым", "acc": "ых", "ins": "ыми", "loc": "ых"},
            },
            "soft": {
                "m": {"nom": "ий", "gen": "его", "dat": "ему", "acc": "ий", "ins": "им", "loc": "им"},
                "ma": {"nom": "ий", "gen": "его", "dat": "ему", "acc": "его", "ins": "им", "loc": "им"},
                "f": {"nom": "яя", "gen": "ей", "dat": "ей", "acc": "юю", "ins": "ей", "loc": "ей"},
                "n": {"nom": "ее", "gen": "его", "dat": "ему", "acc": "ее", "ins": "им", "loc": "ем"},
                "p": {"nom": "ие", "gen": "их", "dat": "им", "acc": "ие", "ins": "ими", "loc": "их"},
                "pa": {"nom": "ие", "gen": "их", "dat": "им", "acc": "их", "ins": "ими", "loc": "их"},
            },
            "mixed_i": {
                "m": {"nom": "ий", "gen": "ого", "dat": "ому", "acc": "ий", "ins": "им", "loc": "ом"},
                "ma": {"nom": "ий", "gen": "ого", "dat": "ому", "acc": "ого", "ins": "им", "loc": "ом"},
                "f": {"nom": "ая", "gen": "ой", "dat": "ой", "acc": "ую", "ins": "ой", "loc": "ой"},
                "n": {"nom": "ое", "gen": "ого", "dat": "ому", "acc": "ое", "ins": "им", "loc": "ом"},
                "p": {"nom": "ие", "gen": "их", "dat": "им", "acc": "ие", "ins": "ими", "loc": "их"},
                "pa": {"nom": "ие", "gen": "их", "dat": "им", "acc": "их", "ins": "ими", "loc": "их"},
            },
            "mixed_o": {
                "m": {"nom": "ой", "gen": "ого", "dat": "ому", "acc": "ой", "ins": "им", "loc": "ом"},
                "ma": {"nom": "ой", "gen": "ого", "dat": "ому", "acc": "ого", "ins": "им", "loc": "ом"},
                "f": {"nom": "ая", "gen": "ой", "dat": "ой", "acc": "ую", "ins": "ой", "loc": "ой"},
                "n": {"nom": "ое", "gen": "ого", "dat": "ому", "acc": "ое", "ins": "им", "loc": "ом"},
                "p": {"nom": "ие", "gen": "их", "dat": "им", "acc": "ие", "ins": "ими", "loc": "их"},
                "pa": {"nom": "ие", "gen": "их", "dat": "им", "acc": "их", "ins": "ими", "loc": "их"},
            },
        };

        function random_chance(chance) {
            return Math.random() < chance;
        }

        function random_range(min, max) {
            return Math.floor(Math.random() * (max - min)) + min;
        }

        function random_element(items) {
            return items[Math.floor(Math.random() * items.length)];
        }

        function random_weighted(items) {
            let total_weight = 0;
            for (let item of items) {
                total_weight += item.weight;
            }
            let weight = random_range(0, total_weight);
            for (let item of items) {
                weight -= item.weight;
                if (weight < 0) {
                    return item.item;
                }
            }
        }

        function capitalize(string) {
            return string[0].toUpperCase() + string.slice(1);
        }

        function replace_template(template, context) {
            let func_and_args = template.slice(1, -1).split(":");
            let func = func_and_args[0];
            let args = func_and_args.slice(1);
            return funcs[func](context, args);
        }

        function parse(word, context) {
            return word.replace(/\[([^\]]+)\]/g, function(x) {
                return replace_template(x, context);
            });
        }

        const qualities = [
            "непонятный",
            "странный",
            "загадочный",
            "необычный",
            "непривычный",
            "удивительный",
            "подозрительный",
            "неестественный",
            "таинственный",
            "непостижимый",
            "любопытный",
            "неразрушимый",
        ];

        const sizes = [
            "крохотный",
            "миниатюрный",
            "маленький",
            "небольшой",
            "тонкий",
            "длинный",
            "большой",
            "толстый",
            "[num:10:20]-сантиметровый",
        ];

        const shapes_pre = [
            "круглый",
            "овальный",
            "треугольный",
            "квадратный",
            "пятиугольный",
            "шестиугольный",
            "семиугольный",
            "восьмиугольный",
            "цилиндрический",
            "несимметричный",
            "деформированный",
            "бесформенный",
            "аморфный",
        ];

        const shapes_post = [
            "странной формы",
            "диковинной формы",
            "в форме шара",
            "в форме паука",
            "в форме сердца",
            "в форме капли",
            "в форме яйца",
            "в форме лица",
            "в форме обнаженного мужчины",
            "в форме обнаженной женщины",
            "в форме меча",
        ];

        const colors = [
            "светлый",
            "темный",
            "красный",
            "зелёный",
            "синий",
            "белый",
            "серый",
            "черный",
            "розовый",
            "фиолетовый",
            "оранжевый",
            "желтый",
            "голубой",
            "алый",
            "тёмно-красный",
            "ярко-красный",
            "кроваво-красный",
            "малиновый",
            "пурпурный",
            "багровый",
            "огненно-красный",
            "бледно-розовый",
            "карминовый",
            "жёлто-зелёный",
            "сине-зеленый",
            "неяркий",
            "матовый",
            "бледный",
            "яркий",
            "тусклый",
            "разноцветный",
            "невидимый",
            "прозрачный",
            "полупрозрачный",
            "светящийся",
            "блестящий",
        ];

        const feels = [
            "теплый",
            "холодный",
            "мягкий",
            "твердый",
            "пористый",
            "шершавый",
            "гладкий",
        ];

        const materials_pre = [
            "металлический",
            "золотой",
            "серебряный",
            "бронзовый",
            "медный",
            "стальной",
            "железный",
            "платиновый",
            "оловянный",
            "латунный",
            "каменный",
            "мраморный",
            "гранитный",
            "стеклянный",
            "хрустальный",
            "янтарный",
            "зеркальный",
            "синтовый",
            "резиновый",
            "тканевый",
            "льняной",
            "шелковый",
            "вязаный",
            "кожаный",
            "деревянный",
            "соломенный",
            "органический",
            "керамический",
            "глиняный",
            "бумажный",
            "картонный",
        ];

        const materials_post = [
            "из растительного волокна",
            "из неизвестного металла",
            "из твердого стекла",
            "из пластичного синта",
            "из прозрачного синта",
            "из кости",
            "из шестеренок и других деталей",
            "из хитина",
            "из папируса",
            "из электрума",
            "из затвердевшей жидкости",
            "из затвердевшего гриба",
            "из затвердевшего света",
            "из затвердевшего звука",
            // йотум
            "из <i>ио</i>",
            "из <i>податливого синта</i>",
            "из <i>способной глины</i>",
            "из <i>биосхематики</i>",
            "из <i>синтстали</i>",
            "из <i>эластичного металла</i>",
            "из <i>лазурной стали</i>",
            "из <i>миметического геля</i>",
            "из <i>квантия</i>",
            "из <i>янтарного хрусталя</i>",
            "из <i>протоматерии</i>",
            "из <i>пыли таума</i>",
            "из <i>умной ткани</i>",
            "из <i>псирания</i>",
            "из <i>каоновых крупиц</i>",
            "из <i>монополя</i>",
            "из <i>полуночного камня</i>",
            "из <i>ораклия</i>",
            "из <i>виртуальных частиц</i>",
            "из <i>космической пены</i>",
            "из <i>прирученного железа</i>",
            "из <i>философина</i>",
            "из <i>даташариков</i>",
            "из <i>скалярных бозонов</i>",
            "из <i>космической пены</i>",
            // йотум 2
            "из <i>бессмертных клеток</i>",
            "из <i>бранных линз</i>",
            "из <i>когнитивных сплетений</i>",
            "из <i>сердцевины-матери</i>",
            "из <i>оптогенетических мышц</i>",
            "из <i>метаболических везикул</i>",
            "из <i>аллофенного нодуля</i>",
            "из <i>ортогоналиевого волокна</i>",
            "из <i>матрицы плодородия</i>",
            "из <i>плюрипотентной массы</i>",
            "из <i>гиперфрустумного компрессора</i>",
            "из <i>нейрофиламентных переплетений</i>",
        ];

        const objects = [
            ["птица", "f"],
            ["лягушка", "f"],
            ["осьминог", "m"],
            ["череп", "m"],
            ["рог", "m"],
            ["игрушка", "f"],
            ["орнитоптер", "m"],
            ["карточка", "f"],
            ["подушка", "f"],
            ["одеяло", "n"],
            ["седло", "n"],
            ["стул", "m"],
            ["прут", "m"],
            ["шнур", "m"],
            ["цветок", "m"],
            ["роза", "f"],
            ["палочка", "f"],
            ["стержень", "m"],
            ["кабель", "m"],
            ["лист", "m"],
            ["шланг", "m"],
            ["сота", "f"],
            ["линза", "f"],
            ["торнадо", "n"],
            ["пуговица", "f"],
            ["растение", "n"],
            ["башенка", "f"],
            ["лезвие", "n"],
            // одежда
            ["шляпа", "f"],
            ["маска", "f"],
            ["корона", "f"],
            ["парик", "m"],
            ["венец", "m"],
            ["шлем", "m"],
            ["рубашка", "f"],
            ["пояс", "m"],
            ["шарф", "m"],
            ["перчатка", "f"],
            ["плащ", "m"],
            // украшения
            ["кольцо", "n"],
            ["браслет", "m"],
            ["перстень", "m"],
            ["амулет", "m"],
            ["кулон", "m"],
            ["подвеска", "f"],
            ["ожерелье", "n"],
            ["колье", "n"],
            ["ножной браслет", "m"],
            ["тиара", "f"],
            ["серьга", "f"],
            ["брошь", "f"],
            ["помандер", "m"],
            // shapes TODO can't have shape adjectives.
            ["куб", "m"],
            ["пирамидка", "f"],
            ["семигранник", "m"],
            ["двенадцатигранник", "m"],
            ["ромбоид", "m"],
            ["антипризма", "f"],
            ["призма", "f"],
            ["шар", "m"],
            ["сфера", "f"],
            ["полушарие", "n"],
            ["пластинка", "f"],
            ["плитка", "f"],
            ["диск", "m"],
            ["квадрат", "m"],
            ["звезда", "f"],
            ["многоугольник", "m"],
            ["шар на цепи", "m"],
            ["ромб", "m"],
            // materials TODO can't have materials,
            ["алмаз", "m"],
            ["камень", "m"],
            ["кристалл", "m"],
            ["комок глины", "m"],
            ["прядь волос", "f"],
            ["комок шерсти", "m"],
            ["слизь", "f"],
            ["кусок фетра", "m"],
            ["желе", "n"],
            // tools
            ["шило", "n"],
            ["долото", "n"],
            ["иголка с ниткой", "f"],
            ["щетка", "f"],
            ["кисточка", "f"],
            ["расческа", "f"],
            ["устройство", "n"],
            ["прибор", "m"],
            ["музыкальный инструмент", "m"],
            ["флейта", "f"],
            ["арфа", "f"],
            ["колокольчик", "m"],
            ["магнит", "m"],
            ["клин", "m"],
            ["дырокол", "m"],
            ["зеркало", "n"],
            ["ложка", "f"],
            ["вилка", "f"],
            ["рукоять", "f"],
            ["стилус", "m"],
            // containers
            ["контейнер", "m"],
            ["клетка", "f"],
            ["горшок", "m"],
            ["бокал", "m"],
            ["сосуд с [color:f:ins] жидкостью", "m"],
            ["набор косметики", "m"],
            ["коробок спичек", "m"],
            ["коробок зубочисток", "m"],
            ["тюбик с [color:m:ins] дымом", "m"],
            ["коробочка с [color:m:ins] порошком", "f"],
            ["банка [color:f:gen] краски", "f"],
            ["чаша", "f"],
            ["чашка", "f"],
            ["кружка", "f"],
            ["тарелка", "f"],
            ["бутылка", "f"],
            ["ракушка", "f"],
        ];

        const with_clauses = [
            "с нарисованными глазами, быстро моргающими на ярком солнце",
            "c лампочками, которые иногда мигают",
            "c вложенными друг в друга круглыми пластинами, вращающимися и издающими щелкающие звуки",
            "c крохотным колокольчиком, звенящим как огромный колокол, будучи случайно задет",
            "c покрытыми перьями крыльями",
            "со стеклянной ручкой",
            "cо стеклянной панелью в центре",
            "c [color:f:ins] лампочкой, пульсирующей в ритме сердцебиения владельца",
            "со стрелкой внутри, всегда указывающей на солнце",
            "с кристаллом в центре",
            "со струнами из светящейся энергии",
            "с металлическим клювом-бритвой",
            "с откручивающейся крышкой, выглядящей как кусок камня",
            "с шестью дырками для глаз",
            "c кучей дырок",
            "c жужжашим звуком внутри",
            "с кнопкой, при нажатии показывающей на крохотном дисплее случайное слово на языке нажавшего",
            "c вырезанным на [p:ploc] ртом",
            "с вырезанным внутри существом (каждые несколько дней оно меняет позу)",
            "с крошечным пультом управления",
            "с человеческим лицом",
            "c многочисленными ветвящимися руками",
            "c надписью, которую каждый читает по-разному",
            "с нечитаемыми и неразрешимыми уравнениями",
            "с дыркой, через которую видно фигуры в облаках, если смотреть через неё на небо",
            "c множеством ветвящихся рук",
            "с экраном и панелью управления",
            "со множеством выростов из синта",
            "с тумблером",
            "с аналоговыми часами",
            "с органическими трубочками и мешочками",
            "с растущими из [p:pgen] корнями",
            "со складной антенной",
            "c микроскопическими волосками",
            "с глазом, который постоянно на тебя смотрит",
            "с отделяемыми лишними частями",
        ];

        const time_adverbs = [
            "изредка",
            "порой",
            "иногда",
            "постоянно",
            "всегда",
            "каждую ночь",
            "каждый день",
        ];

        const that_clauses = [
            "пульсирует, будто дышит",
            "не может быть испачкан[short]",
            "не может быть помят[short]",
            "не может быть сожжен[short], но заморозка превращает [p:acc] в жидкость",
            "весит как сталь, но гнется как резина",
            "легко разбить, но [p] тут же собирается обратно",
            "отпугивает насекомых в радиусе [num:2:4] м",
            "привлекает мух",
            "может использоваться как мыло",
            "может использоваться как мелок (и никогда не заканчивается)",
            "полирует металлические объекты, которых касается",
            "деактивирует случайное устройство поблизости",
            "весит [num:20:30] кг",
            "почти ничего не весит",
            "показывает [color] язык",
            "кусается",
            "потеет",
            "устанавливает телепатическую связь между тобой и случайным существом на планете",
            "предназначен[short] для неизвестных нечеловеческих существ",
            "позволяет видеть как насекомое",
            "вызывает эротические сновидения",
            "вызывает у окружающих голод",
            "слегка опьяняет окружающих",
            "вызывает эйфорию",
            "вызывает головокружение, из-за которого невозможно идти прямо",
            "заставляет любого, кто [p:gen] коснется, произнести \"Фаношил!\"",
            "останавливает рост волос",
            "слегка улучшает твое зрение",
            "лишает тебя способности к размножению",
            "меняет твой голос",
            "делает твои волосы [color:p:ins]",
            "делает твои глаза [color:p:ins]",
            "делает твои губы [color:p:ins]",
            "делает твое дыхание свежим как мята",
            "вызывает у тебя ощущение, будто нежные руки ласкают твое тело",
            "делает тебя постоянно сытым",
            "притупляет твое чувство осязания",
            "притягивается к твоей коже",
            "может проделать круглую дырочку в любом тонком материале",
            "отталкивается от живой плоти",
            "имеет приятный вкус",
            "исчезает, чтобы появиться снова через несколько часов",
            "кишит червями, живущими внутри и на поверхности",
            "покрыт[short] шипами и колючками",
            // colors
            "покрыт[short] странными граффити",
            "случайным образом меняет цвет и текстуру",
            "светится [color:m:ins]",
            "может сканировать объекты и принимать их цвет",
            "светится при использовании",
            "постепенно меняет свой цвет",
            "имеет днем [color] цвет, а ночью [color]",
            "меняет цвет в зависимости от того, кто [p:acc] держит",
            // sounds
            "жужжит",
            "рычит",
            "щебечет",
            "свистит",
            "воет",
            "визжит",
            "вибрирует",
            "шепчет",
            "тихо мурчит",
            "говорит на никому не известном языке",
            "повторяет слова на неизвестном языке",
            "поет колыбельную на неизвестном языке",
            "телепатически болтает чепуху",
            "издает мягкие неприятные звуки",
            "издает тихие звуки \"Алло?..\"",
            "вызывает гудение в ушах",
            "производит мягкий статический шум",
            "производит звуки, похожие на человеческие крики",
            "издает странный шум, звучащий как неприятная атональная музыка",
            "гремит, как будто [p] наполнен[short] камнями",
            "заставляет тебя слышать голоса в голове",
            // qualities
            "неосязаем[short] для всего, кроме специальной перчатки из синта, входящей в комплект",
            "обладает невероятной прочностью",
            "теплее, чем окружающая среда",
            "холоднее, чем окружающая среда",
            "нагревается на холоде и охлаждается в тепле",
            "слишком хорош[short] на ощупь",
            // smells
            "производит калейдоскоп ароматов",
            "пахнет свежестью",
            "пахнет покоем",
            "сильно пахнет сахаром",
            "пахнет свежим хлебом",
            "покрывается прозрачной искрящейся субстанцией, пахнущей морем",
            // shape/form
            "может быть согнут[short] и даже завязан[short] в узел",
            "принимает разные загадочные формы",
            "обвивается вокруг всего, чего касается",
            "растягивается до [num:2:4] м, не ломаясь",
            "складывается в разные сложные формы",
            "иногда становится на время жидкостью",
            // position/movement
            "извивается, будто пытаясь к чему-то подключиться",
            "вращается",
            "висит в воздухе",
            "зависает в горизонтальном положении",
            "парит рядом с тобой",
            "парит, словно воздушный шар",
            "висит рядом с твоим запястьем",
            "кружится вокруг твоей головы",
            "колышется будто от ветра (даже если ветра нет)",
            "может храниться в дополнительном измерении",
            "находится внутри куба (но куб не в фазе, и до него нельзя дотронуться)",
            "находится внутри прозрачного пузыря из твердого стекла",
            // displays
            "показывает вокруг людей ауры цвета, зависящего от времени суток, в которое они родилились",
            "показывает твои мышцы, кости и внутренние органы",
            "показывает светящуюся карту неизвестных созвездий",
            "показывает текущую температуру с помощью двигающихся линий",
            "показывает изображения нового места в Девятом мире каждую пару дней",
            "показывает отражение твоего лица, как оно выглядело вчера",
            "показывает карту чего-то неизвестного",
            "показывает изображение отца того, кто до [p:pgen] дотрагивается",
            "показывает постоянно меняющиеся неизвестные символы",
            "показывает в [num:5:10] раз больше звезд, чем обычно",
            "показывает что-то, что выглядит как вид с воздуха на руины неизвестного города",
            "показывает что-то, что выглядит как вид на луну",
            "испускает не причиняющий вреда тонкий [color:m:acc] луч на расстояние [num:5:15] м",
            "проецирует двумерное изображение неизвестного существа на любую плоскую поверхность",
            "показывает постоянно меняющиеся бессмысленные символы",
            "показывает всевозможных неизвестных существ",
            "показывает неизвестных существ, скачущих среди неизвестных деревьев",
            "показывает сложные и бессмыссленные диаграммы",
            "показыват окрестности с высоты, но всегда совершенно неправильно",
            "позволяет тебе видеть слова, произносимые другими, в виде надписей у них над головами",
            // production
            "производит крохотное пламя",
            "медленно производит духи",
            "производит мыло",
            "выпускает крохотные клубы [color:m:gen] дыма",
            "выпускает клубы висящего дыма, принимающие формы лиц, существ и других вещей",
            "производит немного [color:f:gen] краски",
            "производит маленькие фигурки из синта, изображающие тех, кто находится поблизости",
            "производит пикантный [color:m:acc] сироп",
            // container?
            "открывается, обнажая космическую пустоту",
            "наполнен[short] чем-то, напоминающим лед или снег",
            "окрашивает любую помещенную внутрь жидкость в [color:m:acc] цвет",
            "превращает любую помещенную внутрь жидкость в алкоголь",
            "мгновенно доводит до кипения любую помещенную внутрь жидкость",
            "сохраняет еду внутри свежей бесконечно долго",
            "может быть запечатан[short] и обладает высокой прочностью",
        ];

        const if_clauses = [
            "когда восходит солнце",
            "когда светит луна",
            "когда идет дождь",
            "когда не идет дождь",
            "когда близится буря",
            "когда рядом дым",
            "когда ты ходишь",
            "когда ты спишь",
            "когда ты злишься",
            "когда ты пьян",
            "когда тебе страшно",
            "когда ты тяжело дышишь",
            "когда ты находишься рядом с кем-то, кого любишь",
            "когда никто [p:acc] не видит",
            "когда [p] слышит смех",
            "когда [p] находится в полной темноте",
            "когда [p] находится в [num:10:30] м от нелюдей",
            "когда кто-то говорит с [p:pins]",
            "если [p:acc] активировать",
            "если [p:acc] надеть",
            "если взять [p:acc] в руку",
            "если приложить [p:acc] к уху",
            "если приложить [p:acc] к коже",
            "если положить [p:acc] под голову",
            "если погрузить [p:acc] в воду",
            "если [p:dat] не мешать",
            "если поместить [p:acc] на землю определенной стороной",
            "если [p:acc] поцеловать",
            "если [p:acc] облизать",
            "если [p:acc] сжечь",
            "если [p:acc] сжать",
            "если [p:acc] закопать",
            "ecли [p:acc] нагреть",
            "если [p:acc] охладить",
            "если [p:acc] открыть",
            "если [p:acc] сломать",
            "если [p:acc] встряхнуть",
            "если [p:acc] опрыснуть соленой водой",
            "если в [p:pacc] вглядеться",
            "если в [p:pacc] подуть",
            "если в [p:pacc] посвистеть",
            "если потереть [p:acc] пальцем",
            "если проткнуть [p:ins] кожу",
            "если наполнить [p:acc] жидкостью",
            "если посмотреть сквозь [p:pacc] на ночное небо",
            "если поместить [p:acc] под подбородок определенным людям",
        ];

        const mixed_stem_ends = ["г", "к", "х", "ш", "ч", "щ", "ц"];

        function adjective_conjugation_type(adjective) {
            let ending_start = adjective.charAt(adjective.length - 2);
            let is_mixed = mixed_stem_ends.includes(adjective.charAt(adjective.length - 3));
            if (ending_start == "ы") {
                return "hard_y";
            }
            if (ending_start == "о") {
                return is_mixed ? "mixed_o" : "hard_o";
            }
            return is_mixed ? "mixed_i" : "soft";
        }

        function conjugate_adjective(adjective, gender, kase) {
            gender = gender || "m";
            kase = kase || "nom";
            let conjugation_type = adjective_conjugation_type(adjective);
            return adjective.slice(0, -2) + adjectives_endings[conjugation_type][gender][kase];
        }

        const funcs = {
            "p": function(context, args) {
                let p_case = args[0] || "nom";
                let gender = context.gender || "m";
                return pronoun_cases[p_case][gender];
            },
            "num": function(context, args) {
                return random_range(parseInt(args[0]), parseInt(args[1]));
            },
            "short": function(context) {
                let gender = context.gender || "m";
                return short_adjectives[gender];
            },
            "color": function(context, args) {
                let gender = args[0] || context.gender || "m";
                let kase = args[1];
                return conjugate_adjective(random_element(colors), gender, kase);
            }
        };

        const which = {"m": "который", "f": "которая", "n": "которое"};

        function build_string(parts) {
            let result = "";
            for (let part of parts) {
                if (part) {
                    if (!part.startsWith(",")) {
                        result += " ";
                    }
                    result += part;
                }
            }
            return result;
        }

        function make_oddity() {
            let oddity = {};
            const object = random_element(objects);
            oddity.object = object[0];
            const gender = object[1];
            if (random_chance(quality_chance)) {
                oddity.quality = conjugate_adjective(random_element(qualities), gender);
            }
            if (random_chance(size_chance)) {
                oddity.size = conjugate_adjective(random_element(sizes), gender);
            }
            if (random_chance(feel_chance)) {
                oddity.feel = conjugate_adjective(random_element(feels), gender);
            }
            if (random_chance(shape_chance)) {
                if (random_chance(0.5)) {
                    oddity.shape_pre = conjugate_adjective(random_element(shapes_pre), gender);
                } else {
                    oddity.shape_post = random_element(shapes_post);
                }
            }
            if (random_chance(color_chance)) {
                oddity.color = conjugate_adjective(random_element(colors), gender);
            }
            if (random_chance(material_chance)) {
                if (random_chance(0.6)) {
                    oddity.material_pre = conjugate_adjective(random_element(materials_pre), gender);
                } else {
                    oddity.material_post = random_element(materials_post);
                }
            }
            if (random_chance(with_chance)) {
                oddity.with = random_element(with_clauses);
            }
            if (random_chance(that_chance)) {
                let oddity_that = ", " + which[gender];
                let time_used = false;
                if (random_chance(time_adverb_chance)) {
                    oddity_that += " " + random_element(time_adverbs);
                    time_used = true;
                }
                oddity_that += " " + random_element(that_clauses);
                if (!time_used && random_chance(if_chance)) {
                    oddity_that += ", " + random_element(if_clauses);
                }
                oddity.that = oddity_that;
            }
            let oddity_string = build_string([
                oddity.quality,
                oddity.size,
                oddity.feel,
                oddity.shape_pre,
                oddity.color,
                oddity.material_pre,
                oddity.object,
                oddity.material_post,
                oddity.shape_post,
                oddity.with,
                oddity.that
            ]);
            oddity_string += ".";
            document.getElementById("text").innerHTML = capitalize(parse(oddity_string, {"gender": gender}).trim());
        }

        const corridor_features = [
            {"item": "длиной [num:5:20] метров", "weight": 7}, // roll again
            {"item": "длиной несколько метров", "weight": 3},
            {"item": ", перегороженный обвалом", "weight": 1},
            {"item": ", заканчивающийся тупиком", "weight": 1},
            {"item": ", изгибающийся влево", "weight": 1},
            {"item": ", изгибающийся вправо", "weight": 1},
            {"item": ", поднимающийся наверх", "weight": 1},
            {"item": ", спускающийся вниз", "weight": 1},
            {"item": ", ведущий параллельно предыдущему куску", "weight": 1}, // roll again
            {"item": ", ведущий через полость", "weight": 1}, // roll again
            {"item": ", заканчивающийся T-образным перекрестком", "weight": 1},
            {"item": ", заканчивающийся X-образным перекрестком", "weight": 1},
        ];

        const room_sizes = [
            {"item": "маленький", "weight": 2},
            {"item": "[num:5:25]-метровый", "weight": 18},
        ];

        const room_shapes = [
            {"item": "круглый", "weight": 2},
            {"item": "квадратный", "weight": 2},
            {"item": "прямоугольный", "weight": 13},
            {"item": "шестиугольный", "weight": 1},
            {"item": "полукруглый", "weight": 1},
            {"item": "треугольный", "weight": 1},
        ];

        const relic_anatomies = [
            {"item": "рука", "weight": 3},
            {"item": "рот", "weight": 3},
            {"item": "глаз", "weight": 3},
            {"item": "ухо", "weight": 2},
            {"item": "лицо", "weight": 1},
            {"item": "нога", "weight": 1},
            {"item": "хребет", "weight": 1},
            {"item": "сердце", "weight": 1},
            {"item": "желудок", "weight": 1},
            {"item": "легкое", "weight": 1},
            {"item": "кишка", "weight": 1},
            {"item": "нос", "weight": 1},
            {"item": "мозг", "weight": 1},
        ];

        const chamber_features = [
            "сложный узел из синта (связывается обратно, если его развязать)",
            "парящая [color:f] сфера, меняющая оттенок при касании",
            "стеклянные панели, отражения в которых движутся назад во времени",
            "[color:f] жидкость, превращающаяся в газ, если согреть ее касанием",
            "хрустальные цилиндры, заполненные тысячами мертвых лааков",
            "[color:p] хрустальные стержни, вызывающие ускоренное старение (на день в минуту)",
            "сферы, которые ярко светятся, если двигаться",
            "текущая вода, которая создает ледяные скульптуры дивных форм",
            "порты для пупка, при подключении раз в день дающие +1 к <i>остроте интеллекта</i> на час",
            "порты для пупка, при подключении погружающие на час в глубокий сон и вызывающие странные сны",
            "хрустальный купол, показывающий вид на Девятый мир из космоса",
            "хрустальный купол, показывающий смотрящим их версии из параллельного измерения",
            "хрустальный купол, показывающий карту комнаты, а также всех комнат на дальнем расстоянии",
            "хрустальный купол, показывающий руины снаружи",
            "квадратный бассейн [color:f:gen] жидкости, густой как мед",
            "квадратный бассейн [color:f:gen] жидкости, пытающейся покрыть исследователей второй кожей, мешающей видеть и дышать",
            "квадратный бассейн кипящей [color:f:gen] жидкости, холодной на ощупь",
            "квадратный пустой бассейн c [color:m:ins] кристаллическим осадком на дне (осадок при увлажнении превращается в существо)",
            "кокон, который обезвоживает входящих в него живых существ, оставляя лишь тонкую шелуху (увлажнение требует проверку интеллекта)",
            "липкий электростатический пол, удерживающий исследователей",
            "[color] цилиндр, который излучает поле низкой гравитации",
            "[color] цилиндр, который излучает поле высокой гравитации",
            "[color] цилиндр, притягиваюший металлические объекты",
            "[color] цилиндр, отталкивающий металлические объекты",
            "[color] цилиндр, который издает инфразвуковые вибрации",
            "скульптура из синта постепенно двигается, если ее дотронуться",
            "сложные узоры внутри кристалла, которые помещают разум смотрящих в психический лабиринт",
            "сложные узоры внутри кристалла, которые вызывают у смотрящих смех от неожиданного удовольствия",
            "сложные узоры внутри кристалла, которые дают смотрящим интеллектуальное преимущество в следующей задаче",
            "сложные узоры внутри кристалла, которые вызывают у смотрящих необъяснимую грусть",
            "арка, которая копирует проходящих сквозь нее, но копии не имеют экипировки и мертвы",
            "арка, которая очищает проходящих сквозь нее",
            "арка, которая  похищает один орган у проходящих сквозь нее",
            "стеллаж, полный устройств, при активации жужжащих и шепчущих на неизвестном языке",
            "сложное устройство со сверкающей плоской поверхностью, высасывающей воду при касании",
            "стеллаж, полный устройств, при активации минуту мерцающих все быстрее и быстрее, а затем снова замирающих",
            "стеллаж, полный устройств, при активации становящихся в [num:5:10] раз тяжелей",
            "стеллаж, полный устройств, шепчущих оскорбления на языке использовашего их",
            "широкая металлическая урна, из которой вылетают и вскоре лопаются кристаллические пузыри",
            "широкая металлическая урна, из которой вылетают и вскоре лопаются жидкие пузыри, задающие телепатически любопытные вопросы",
            "широкая металлическая урна, из которой вылетают и вскоре лопаются опасные кислотные пузыри",
            "скульптура из колышущегося света, напоминающая человеческий мозг с тремя полушариями",
            "скульптура из колышущегося света, вдруг включающаяся и показывающая мозг ближайшего исследователя",
            "скульптура из колышущегося света в виде портала, через который видны звезды и галактики",
            "десятки [color:p:gen] сфер, мягких на ощупь, которые образуют механизм, испускающий запах сирени и озона",
            "металлический кокон, обращающий содержимое в камень",
            "металлический кокон, помещающий содержимое в стазис",
            "металлический кокон, окрашивающий содержимое в ярко-синий цвет",
            "металлический кокон, делающий непрозрачные объекты полупрозрачными",
            "металлический кокон, превращающий твердые объекты в жидкость",
            "металлический кокон, замораживающий содержимое",
            "металлический кокон, постоянно выбрасывающий похожую на дрит [color:f:acc] жидкую «грязь»",
            "металлический кокон, который жужжит и вибрирует, но делает больше ничего очевидного",
            "случайная диковина",
            "стеклянный барьер, за которым подводный биом",
            "стеклянный барьер, за которым в похожем на жидкость полупрозрачном тумане, кажется, двигаются странные существа",
            "хрустальные колонны, внутри которых, кажется, находятся мертвые гуманоиды без кожи",
            "хрустальные колонны, которые светятся, если рядом <i>шифры</i>",
            "хрустальные колонны, истощающие находящиеся рядом <i>шифры</i>",
            "хрустальная колонна, показывающася странные символы на языке, слишком сложном для человека",
            "коробочка из синта, добавляющая ноги помещенным внутрь предметам",
            "коробочка из синта, добавляющая глаза помещенным внутрь предметам",
            "пустые коробочки из синта, двигающиеся из одной стены в другую по конвееру, над которым расположен мертвый механизм",
            "пустые коробочки из синта, двигающиеся из одной стены в другую по конвееру, над которым расположен механизм, помещающий в каждую двадцатую коробочку полуночный камень",
            "пустые коробочки из синта, двигающиеся из одной стены в другую по конвееру, над которым расположен механизм, помещающий в каждую десятую коробочку дрит",
            "пустые коробочки из синта, двигающиеся из одной стены в другую по конвееру, над которым расположен механизм, помещающий в каждую десятую коробочку мертвые нуменеры",
            "машина, сплавляющая любую пару объектов, находящихся поблизости",
            "машина, разрезающая пополам любой объект, находящийся поблизости",
            "машина, перетирающая маленькие объекты в дрит",
            "машина, доводящая объекты до кипения",
            "машина, добавляющая объектам крохотные колесики",
            "машина, добавляющая объектам металлические глаза",
            "машина, пришивающая к объектам металлические провода",
            "металлические провода, поглощающие все звуки поблизости",
            "металлические провода, усиливающая все звуки поблизости",
            "машина из синта, делающая металл ржавым",
            "машина из синта, намагничивающая металл",
            "машина из синта, электризующая металл",
            "две большие парящие в воздухе и вращающиеся металлические сферы",
            "две большие парящие в воздухе и вращающиеся металлические сферы, разблокирующие и усиливающие нуменеры поблизости",
            "две большие парящие в воздухе и вращающиеся металлические сферы, блокирующие и ослабляющие нуменеры поблизости",
            "две большие парящие в воздухе и вращающиеся металлические сферы, останавливающиеся, если задан вопрос, и продолжающие вращение, если получен ответ",
            "две большие парящие в воздухе и вращающиеся металлические сферы, сияющие ярко-красным светом, если в комнате находится визитер или создание из другого измерения",
            "парящая в воздухе сферическая область, поедающая весь свет",
            "парящая в воздухе сферическая область, телепортирующая брошенные в нее предметы",
            "парящая в воздухе сферическая область, деинтегрирующая брошенные в нее предметы",
            "черная прямоугольная пластина, издающая глубокое жужжание",
            "черная прямоугольная пластина, на которой показываются мысли стоящих рядом",
            "черная прямоугольная пластина, перемещающая сознание стоящих рядом в маленькую парящую в воздухе желтую сферу",
            "стены, при касании на несколько минут активирующие приборы на потолке, выпускающие слегка ядовитый газ",
            "стены, при касании на несколько минут активирующие настенные приборы, производящие слегка питательную и ужасную на вкус белую пасту",
            "стены, при касании один раз вызывающие взрыв находящегося внутри комнаты прибора",
            "стены, одна из которых при касании поднимается и открывает проход в другую комнату",
        ];

        const events = [
            "В области начинается землетрясение длительностью около минуты, сопровождающееся [color:f:ins] дымкой и высокими звуками музыки. <i>Проверка защиты скоростью (уровень 5)</i>. Проваливших проверку опрокидывает, и они получают <i>5 урона</i>.",
            "Неуловимые сначала запахи медленно усиливаются до неописуемых аппетитных ароматов, вызывая у всех непреодолимое слюноотделение. Аромат рассеивается через минуту, но пока вызванный им голод не будет утолен, он продолжает сбивать с толку, являясь <i>помехой</i> для всех <i>задач</i>.",
            "Буря <i>материи пустоты</i> проносится сквозь область. Каждое находящее здесь существо испытывает на себе эффект <i>полуночного камня</i>.",
            "Золотистый туман появляется из ниоткуда, заполняя область и соседние области на час. Существа в тумане чувствуют себя вольно, ветренно и счастливо. Забываются все обиды и предубеждения, а обычный ход мыслей начинает казаться лишь чередой нелепых ошибок.",
        ];

        function relic_anatomy() {
            return random_weighted(relic_anatomies);
        }

        function room_shape() {
            return random_weighted(room_shapes);
        }

        function room_size() {
            return random_weighted(room_sizes);
        }

        function chamber_size_shape() {
            return capitalize(conjugate_adjective(room_size(), "f")) +
                " " + conjugate_adjective(room_shape(), "f") +
                " " + "комната.";
        }

        function make_corridor() {
            let feature = random_weighted(corridor_features);
            if (!feature.startsWith(",")) {
                feature = " " + feature;
            }
            return "Коридор" + feature + ".";
        }

        function make_chamber() {
            let result = chamber_size_shape();
            result += " Внутри " + random_element(chamber_features) + ".";
            if (random_chance(0.02)) {
                result += " Это ловушка!";
            }
            return result;
        }

        function make_creature() {
            return "Существо.";
        }

        function make_explorers() {
            return "Исследователи.";
        }

        function make_cavity() {
            return "Полость.";
        }

        function make_accessway() {
            return "Проход.";
        }

        function make_rupture() {
            return "Трещина.";
        }

        function make_shaft() {
            return "Шахта.";
        }

        function make_colony() {
            return "Колония нелюдей.";
        }

        function make_machine() {
            return "Машина.";
        }

        function make_leak() {
            return "Утечка материи.";
        }

        function make_discharge() {
            return "Разряд энергии.";
        }

        function make_event() {
            let result = "Странное событие. ";
            result += random_element(events);
            return result;
        }

        function make_vault() {
            return "Хранилище.";
        }

        function make_relic() {
            let result = "Реликвия-" + relic_anatomy() + ".";
            if (random_chance(0.8)) {
                result += " Охраняется существом.";
            }
            return result;
        }

        function make_ruin() {
            let make = random_weighted([
                {"item": make_corridor, "weight": 20},
                {"item": make_chamber, "weight": 28},
                {"item": make_creature, "weight": 12},
                {"item": make_explorers, "weight": 5},
                {"item": make_cavity, "weight": 4},
                {"item": make_accessway, "weight": 3},
                {"item": make_rupture, "weight": 3},
                {"item": make_shaft, "weight": 3},
                {"item": make_colony, "weight": 3},
                {"item": make_machine, "weight": 2},
                {"item": make_leak, "weight": 2},
                {"item": make_discharge, "weight": 2},
                {"item": make_event, "weight": 1},
                {"item": make_vault, "weight": 1},
                {"item": make_relic, "weight": 1},
            ])
            return parse(make(), {});
        }
    </script>
</html>
